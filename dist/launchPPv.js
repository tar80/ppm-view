var e,validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return Number.isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},r=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},isEmptyObj=function(e){if(e===undefined)return!1;if(null===e)return!0;for(var t in e)return!1;return!0},isZero=function(e){return null!=e&&("0"===e||0===e)},n={":DIR":"dir",":CPL":"hex",":SCR":"hex",":EXE":"hex",":EXE32":"hex",":EXE32C":"hex",":EXEDOS":"hex",":EXEX64":"hex",":EXEX64C":"hex",":PIF":"hex",":DLL":"hex",":DRV":"hex",":IME":"hex",":OCX":"hex",":SYS":"hex",":VXD":"hex",":HHELP":"hex",":MP4":"hex",":EBML":"hex",":WAV":"hex",":SMF":"hex",":RIFF":"hex",":RCM":"hex",":LHA":"hex",":CAB":"hex",":PKZIP":"hex",":RAR":"hex",":SZDD":"hex",":ZOO":"hex",":ARJ":"hex",":AR":"hex",":TAR":"hex",":ANI":"image",":AVI":"image",":BMP":"image",":EMF":"image",":GIF":"image",":ICON":"image",":PNG":"image",":TIFF":"image",":JPEG":"image",":PS":"image",":CDX":"image",":ACAD":"image",":WEBP":"image",":WMF":"image",":HTML":"doc",":RTF":"doc",":PDF":"doc",":JIS":"doc",":WRITE":"doc",":DOCS":"doc",":OA2":"doc",":XCHG":"doc",":HELP":"doc",":LINK":"link",":FILELINK":"link",":TC1":"ppx",":TC2":"ppx",":TH1":"ppx",":TH2":"ppx",":XVBS":"cmd",":XJS":"javascript",":XPLS":"perl",":XLF":"json"},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=extractFileName(r),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},actualPath=function(e){return PPx.Extract('*ifmatch "o:e,a:p","'+e+'"%:%*linkedpath('+e+")")||e},extractFileName=function(e,t){return void 0===t&&(t="\\"),"\\"!==t&&"/"!==t&&(t="\\"),e.slice(e.lastIndexOf(t)+1)};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/,"")}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var e=[],t=0,r=this.length;t<r;t++){var n=this[t];null==n||""===n||n instanceof Array&&0===n.length||n instanceof Object&&isEmptyObj(n)||e.push(n)}return e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var a=null!=t?t:0;if(Math.abs(a)===Infinity&&(a=0),a>=i)return-1;for(r=Math.max(a>=0?a:i-Math.abs(a),0);r<i;){if(r in n&&n[r]===e)return r;r++}return-1}),e=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(e);var _setStdin=function(e,t){return e?'-io:string,"'+e+'"':t?'-io:send,"'+t.join("%bl")+'"':""},runStdout=function(e){var t=e.cmdline,r=e.wd,n=e.extract,i=void 0!==n&&n,a=e.startmsg,o=void 0!==a&&a,c=e.hide,u=void 0!==c&&c,p=e.utf8,x=void 0!==p&&p,s=e.trim,l=void 0!==s&&s,m=e.single,d=e.multi,f=[u?"-noppb -hide":"-min",o?"":"-nostartmsg",r?"-d:"+r:"",x?"-io:utf8":"",_setStdin(m,d)].join(" ");i||(t="%("+t+"%)");var P=PPx.Extract("%OC %*run("+f+" "+t+")"),h=Number(PPx.Extract());return l&&!isEmptyStr(P)&&(P=P.trim()),[h,P]},i="workerPPv",a=i+".stay.js",susieExtensions=function(){var e=/\*\.\w+/gm;return PPx.Extract("%*getcust(P_susie)").toLowerCase().match(e)||[]},o={composeCmdline:function(e,t,r){return void 0===r&&(r=[]),["0"!==e?"-r -bootid:"+e.slice(-1):"-r",'"'+t+'"'].concat(r).join(" ")},expandExt:function(e,t){var r=PPx.GetFileInformation(e),i=n[r];if("javascript"===i||"perl"===i||"cmd"===i||"json"===i)return[i,i];if("image"!==i){var a=susieExtensions(),o=r.toLowerCase().replace(":","*.");~a.indexOf(o)&&(i="image")}return[t,i]},buildBatCommandWithNkf:function(e,t,r,n){var i="-utf8",a="%Obd",o="bat "+"--paging=never --color=always --style=changes --wrap=never"+" "+r,c="%si'TempFile' 2>&1",u=isEmptyStr(t)?"":" -l "+t,p=a+" "+o+u+" "+e+" >"+c,x=a+' nkf -w "'+e+'" | '+o+" "+u+" >"+c,s=a+' nkf -W16L -w16L "'+e+'" | '+o+u+" >"+c,l=runStdout({hide:!0,trim:!0,cmdline:"nkf -g "+e})[1],m="ASCII"===l||"BINARY"===l;if(n){if("UTF8"===n)return[i,p];if(m&&"SJIS"===n)return[i,p];if(m&&"UNICODE"===n)return[i,s]}return"UTF-8"===l||"UTF-16"===l?[i,p]:m||m?["",""]:[i,x]}},c={en:{invalidDir:"Invalid directory",unsupportedDir:"Unsupported directory",unknown:"Unknown path"},ja:{invalidDir:"無効なディレクトリ",unsupportedDir:"非対象ディレクトリ",unknown:"不明なパス"}}[useLanguage()],main=function(){var e=safeArgs("0","0","0","0","0","",""),t=e[0],n=e[1],a=e[2],u=e[3],p=e[4],x=e[5],s=e[6],l=PPx.Extract("%R"),m=PPx.Extract("%t")||l,d=PPx.Extract("%FDN"),f="";switch(PPx.DirectoryType){case 0:case 2:statusMessage(c.invalidDir);break;case 5:case 6:case 7:case 8:case 9:case 10:statusMessage(c.unsupportedDir);break;case 21:d=d.replace(/^ftp/,"http"),activatePPv(a,u,o.composeCmdline(t,d+"/"+l),f,s);break;case 62:case 63:case 64:case 96:d=""+tmp().dir+extractFileName(d),r.FolderExists(d)||PPx.Execute("*makedir "+d),r.FileExists(d+"\\"+l)||PPx.Extract("*unpack "+d+"%&");default:if("?"===(d=d.replace(/^aux:(\/\/)?S_[^\/\\]+[\/\\]/,""))||isEmptyStr(d)){statusMessage(c.unknown);break}var P=actualPath(d+"\\"+l),h="0"!==n?[m,n]:o.expandExt(P,m),E=h[0],g=h[1];if("dir"!==g){var v;if("txt"===E.toLowerCase())v=o.composeCmdline(t,P,["-text"]);else if("hex"===g)v=o.composeCmdline(t,P,["-hex"]);else if("doc"===g)v=o.composeCmdline(t,P,["-document"]);else if("ppx"===g)v=o.composeCmdline(t,P,["-utf16"]);else if("image"===g)v=o.composeCmdline(t,P,["-image","-colorprofile","-checkeredpattern"]);else if("0"===p||isEmptyStr(E))v=o.composeCmdline(t,P);else{var C;"8"===p?C="UTF8":"16"===p&&(C="UNICODE");var F=o.buildBatCommandWithNkf(l,E,x,C),D=F[0],I=[D,'-document:"%('+F[1]+'%)"'];v=o.composeCmdline(t,P,I),"2"===p&&isEmptyStr(D)&&(f="%%:*js \":%%sp'"+i+"',ppx_SyntaxUpdate\","+x)}activatePPv(a,u,v,f,s)}}},statusMessage=function(e){return PPx.linemessage('!"'+e)},activatePPv=function(e,t,r,n,i){var o=pathSelf().parentDir,c=PPx.Extract("%*getcust(X_vpos)"),u=c!==e;t=isZero(e)?t:"0",u&&PPx.Execute("*customize X_vpos="+e),PPx.Execute("*ppv "+r+" -k *script "+o+"\\"+a+","+t+","+i+n),u&&PPx.Execute("*setcust X_vpos="+c)};main();
