Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var a=null!=t?t:0;if(Math.abs(a)===Infinity&&(a=0),a>=i)return-1;for(r=Math.max(a>=0?a:i-Math.abs(a),0);r<i;){if(r in n&&n[r]===e)return r;r++}return-1});var e,validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return Number.isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},useLanguage=function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"ja"===e?e:t.language},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},r=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(e){return""===e},isEmptyObj=function(e){if(e===undefined)return!1;if(null===e)return!0;for(var t in e)return!1;return!0},n={":DIR":"dir",":CPL":"hex",":SCR":"hex",":EXE":"hex",":EXE32":"hex",":EXE32C":"hex",":EXEDOS":"hex",":EXEX64":"hex",":EXEX64C":"hex",":PIF":"hex",":DLL":"hex",":DRV":"hex",":IME":"hex",":OCX":"hex",":SYS":"hex",":VXD":"hex",":HHELP":"hex",":MP4":"hex",":EBML":"hex",":WAV":"hex",":SMF":"hex",":RIFF":"hex",":RCM":"hex",":LHA":"hex",":CAB":"hex",":PKZIP":"hex",":RAR":"hex",":SZDD":"hex",":ZOO":"hex",":ARJ":"hex",":AR":"hex",":TAR":"hex",":ANI":"image",":AVI":"image",":BMP":"image",":EMF":"image",":GIF":"image",":ICON":"image",":PNG":"image",":TIFF":"image",":JPEG":"image",":PS":"image",":CDX":"image",":ACAD":"image",":WEBP":"image",":WMF":"image",":HTML":"doc",":RTF":"doc",":PDF":"doc",":JIS":"doc",":WRITE":"doc",":DOCS":"doc",":OA2":"doc",":XCHG":"doc",":HELP":"doc",":LINK":"link",":FILELINK":"link",":TC1":"ppx",":TC2":"ppx",":TH1":"ppx",":TH2":"ppx",":XVBS":"cmd",":XJS":"javascript",":XPLS":"perl",":XLF":"json"},actualPath=function(e){return PPx.Extract('*ifmatch "o:e,a:p","'+e+'"%:%*linkedpath('+e+")")||e},extractFileName=function(e,t){return void 0===t&&(t="\\"),"\\"!==t&&"/"!==t&&(t="\\"),e.slice(e.lastIndexOf(t)+1)};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/,"")}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var e=[],t=0,r=this.length;t<r;t++){var n=this[t];null==n||""===n||n instanceof Array&&0===n.length||n instanceof Object&&isEmptyObj(n)||e.push(n)}return e}),e=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(e);var _setStdin=function(e,t){return e?'-io:string,"'+e+'"':t?'-io:send,"'+t.join("%bl")+'"':""},runStdout=function(e){var t=e.cmdline,r=e.wd,n=e.extract,i=void 0!==n&&n,a=e.startmsg,o=void 0!==a&&a,u=e.hide,c=void 0!==u&&u,x=e.utf8,p=void 0!==x&&x,s=e.trim,d=void 0!==s&&s,l=e.single,m=e.multi,f=[c?"-noppb -hide":"-min",o?"":"-nostartmsg",r?"-d:"+r:"",p?"-io:utf8":"",_setStdin(l,m)].join(" ");i||(t="%("+t+"%)");var h=PPx.Extract("%OC %*run("+f+" "+t+")"),P=Number(PPx.Extract());return d&&!isEmptyStr(h)&&(h=h.trim()),[P,h]},susieExtensions=function(){var e=/\*\.\w+/gm;return PPx.Extract("%*getcust(P_susie)").toLowerCase().match(e)||[]},i={composeCmdline:function(e,t,r){return void 0===r&&(r=[]),["0"!==e?"-r -bootid:"+e.slice(-1):"-r",'"'+t+'"'].concat(r).join(" ")},expandExt:function(e,t){var r=PPx.GetFileInformation(e),i=n[r];if("javascript"===i||"perl"===i||"cmd"===i||"json"===i)return[i,i];if("image"!==i){var a=susieExtensions(),o=r.toLowerCase().replace(":","*.");~a.indexOf(o)&&(i="image")}return[t,i]},buildBatCommandWithNkf:function(e,t,r,n){var i="-utf8",a="%Obd",o="bat "+"--paging=never --color=always --style=changes --wrap=never"+" "+r,u="%si'TempFile' 2>&1",c=isEmptyStr(t)?"":" -l "+t,x=runStdout({hide:!0,trim:!0,cmdline:"nkf -g "+e})[1],p="ASCII"===x||"BINARY"===x;if(n){if(p&&"SJIS"===n)return[i,a+" "+o+c+" "+e+" >"+u];if(p&&"UNICODE"===n)return[i,a+' nkf -W16L -w16L "'+e+'" | '+o+c+" >"+u]}return"UTF-8"===x||"UTF-16"===x?[i,a+" "+o+c+" "+e+" >"+u]:p||p?["",""]:[i,a+' nkf -w "'+e+'" | '+o+" "+c+" >"+u]}},a={en:{invalidDir:"Invalid directory",unsupportedDir:"Unsupported directory",unknown:"Unknown path"},ja:{invalidDir:"無効なディレクトリ",unsupportedDir:"非対象ディレクトリ",unknown:"不明なパス"}}[useLanguage()],main=function(){var e=safeArgs("0","",""),t=e[0],n=e[1],o=e[2],u=PPx.Extract("%R"),c=PPx.Extract("%t")||u,x=PPx.Extract("%FDN");switch(PPx.DirectoryType){case 0:case 2:statusMessage(a.invalidDir);break;case 5:case 6:case 7:case 8:case 9:case 10:case 21:statusMessage(a.unsupportedDir);break;case 62:case 63:case 64:case 96:x=""+tmp().dir+extractFileName(x),r.FolderExists(x)||PPx.Execute("*makedir "+x),r.FileExists(x+"\\"+u)||PPx.Extract("*unpack "+x+"%&");default:if("?"===(x=x.replace(/^aux:(\/\/)?S_[^\/\\]+[\/\\]/,""))||isEmptyStr(x)){statusMessage(a.unknown);break}var p=actualPath(x+"\\"+u),s=i.expandExt(p,c),d=s[0],l=(s[1],i.buildBatCommandWithNkf(u,d,o,n)),m=[l[0],'-document:"%('+l[1]+'%)"'],f=i.composeCmdline(t,p,m);activatePPv(f)}},statusMessage=function(e){return PPx.linemessage('!"'+e)},activatePPv=function(e){PPx.Execute("*ppv "+e)};main();
