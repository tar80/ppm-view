var isEmptyStr=function(e){return""===e},isEmptyObj=function(e){if(e===undefined)return!1;if(null===e)return!0;for(var t in e)return!1;return!0},isZero=function(e){return null!=e&&("0"===e||0===e)},pathSelf=function(){var e,t,n=PPx.ScriptName;return~n.indexOf("\\")?(e=extractFileName(n),t=PPx.Extract("%*name(DKN,"+n+")")):(e=n,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},extractFileName=function(e,t){return void 0===t&&(t="\\"),"\\"!==t&&"/"!==t&&(t="\\"),e.slice(e.lastIndexOf(t)+1)};Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return-1;var o=null!=t?t:0;if(Math.abs(o)===Infinity&&(o=0),o>=r)return-1;for(n=Math.max(o>=0?o:r-Math.abs(o),0);n<r;){if(n in i&&i[n]===e)return n;n++}return-1});var e=["KC_main","KV_main","KV_img","KV_crt","KV_page","KB_edit","K_ppe","K_edit"],_validTable=function(t){return~e.indexOf(t)?t:"KC_main"},_discard=function(e){return function(t){var n=t.table,i=t.label,r=t.mapkey,o=t.cond,a=void 0===o?"instantly":o,u=t.debug,c=void 0===u?"0":u,x=PPx.StayMode,s=PPx.Extract("%n"),p=PPx.Extract("%FDV"),d="*linecust "+i+s+","+_validTable(n)+":"+e+",",P={instantly:"",once:'*if("'+s+'"=="%n")%:',hold:'*if("'+s+'"=="%n")&&("'+p+'"!="%FDV")%:'}[a],f=[d];r&&(PPx.Execute("*mapkey use,"+r),f.push("*mapkey delete,"+r)),f.push('*js ":'+x+',ppx_Discard",'+c+","+i),PPx.Execute(d+"%(*if %*stayinfo("+x+")%:"+P+f.join("%:")+"%)"),PPx.Execute('*run -nostartmsg %0pptrayw.exe -c %%K"@LOADCUST"')}},getStaymodeId=function(e){var t=Number(PPx.Extract("%*getcust(S_ppm#staymode:"+e+")"));return!Number.isNaN(t)&&t>1e4&&t},ppx_Discard=function(e,t){var n;PPx.StayMode=0,t=null!=(n=t)?n:"","DEBUG"===e&&PPx.linemessage("[DEBUG] discard "+t)},t=(_discard("ACTIVEEVENT"),_discard("LOADEVENT"),function(e,t,n,i,r){var o="*linecust "+n+","+_validTable(e),a=o+":"+t+",",u={instantly:"",once:'*if("%n"=="%%n")',hold:'*if("%n"=="%%n")&&("%FDV"=="%%FDV")'}[r];PPx.Execute(o+":"+t+","+u+"%%:"+a+"%%:"+i),PPx.Execute('%K"@LOADCUST"')});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/,"")}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var e=[],t=0,n=this.length;t<n;t++){var i=this[t];null==i||""===i||i instanceof Array&&0===i.length||i instanceof Object&&isEmptyObj(i)||e.push(i)}return e});n=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(n);var n,i=80120,r="workerPPv",o="lazyRestore.js",a="getSyntaxDocument.js",debugMsg=function(e,t){"DEBUG"===e&&PPx.Execute("*execute C,*linemessage [DEBUG] "+t)};!function(){return 0===PPx.Extract("%n").indexOf("V")}&&PPx.Quit(-1);var u=50,c="ppmview_worker",x=Number(PPx.Extract("%*getcust(S_ppm#global:disp_width)")),s=x/2-u,p={idName:PPx.WindowIDName.slice(-1)},main=function(){var e=PPx.Arguments.Item(-1).split(","),t=e[0],n=e[1],o=e[2],a=e[3],u=e[4],c=getStaymodeId(r)||i;PPx.StayMode=c,PPx.setProcessValue(r,c),cacheOptions(),ppx_resume(t,n,o,a,u)},ppx_resume=function(e,t,n,i,r){void 0===r&&(r=""),p.dodge="1"===e,p.debugMode=r,updateValue("tmod",t),updateValue("xwin",n),updateValue("winpos",i),setSelectEvent(),debugMsg(p.debugMode,"ppx_resume dodge:"+e+",tmod:"+p.tmod+",xwin:"+p.xwin+",winpos:"+p.winpos),ppx_Dodge()},ppx_GetValue=function(e){return String(p[e])},ppx_Dodge=function(){p.dodge&&"1"===PPx.Extract("%*ppxlist(+V)")&&PPx.Execute("*windowposition V"+p.idName+","+horPos()+","+vertPos())},ppx_ToggleDodge=function(){p.dodge=!p.dodge,setSelectEvent(!0)},ppx_ToggleWrap=function(){p.hasWrap=!p.hasWrap;var e=PPx.Extract("%L"),t=p.hasWrap?["-1","wrap"]:["0","no wrap"],n=t[0],i=t[1];PPx.Execute("*viewoption -"+p.codepage+" -width:"+n+"%:*jumpline "+e+"%:*linemessage "+i)},ppx_ToggleTopmost=function(){p.hasTopmost=!p.hasTopmost;var e=p.hasTopmost?["1","topmost"]:["0","no topmost"],t=e[0],n=e[1];PPx.Execute("*topmostwindow %N,"+t+"%:*linemessage "+n)},ppx_SyntaxUpdate=function(e){if(void 0===e&&(e=""),"TEXT"===p.viewtype||"DOCUMENT"===p.viewtype){var t=PPx.Extract("%*script(\"%sgu'ppmlib'\\expandSource.js\",ppm-view,path)");if(isEmptyStr(t))return;PPx.Execute("*execute C,*script "+t+"\\dist\\"+a+","+p.idName+","+p.codepage+","+e)}},ppx_Close=function(e){var t=p.tmod||p.xwin||p.winpos;if(p.dodge&&PPx.Execute("*linecust "+c+",KC_main:SELECTEVENT,"),p.tmod&&PPx.Execute("*setcust XV_tmod="+p.tmod),t){var n=pathSelf().parentDir;PPx.Execute("*run -nostartmsg -hide -breakjob -noppb %0ppbw.exe -c *script "+n+"\\"+o+","+p.idName+',"'+p.winpos+'","'+p.xwin+'","$'+p.debugMode+'"')}else isZero(e)||PPx.Execute('*execute C,*js "if(PPx.SyncView>0){PPx.SyncView=0;};"');debugMsg(p.debugMode,"ppx_Close tmod:"+p.tmod+",xwin:"+p.xwin+",winpos:"+p.winpos),PPx.StayMode=0},ppx_finally=function(){debugMsg(p.debugMode,"ppx_finally workerPPv")},updateValue=function(e,t){t&&!isEmptyStr(t)&&(p[e]=t)},cacheOptions=function(){var e,t=/^.*-(HEX|TEXT|DOCUMENT|IMAGE|RAWIMAGE).*$/,n=PPx.Extract("%*viewoption");p.viewtype=n.replace(t,"$1"),p.codepage=null==(e=n.split(" ",2)[1])?void 0:e.slice(1),p.esc=isZero(n.indexOf("-esc:1")),p.mime=isZero(n.indexOf("-mime:1")),p.tag=isZero(n.indexOf("-tag:1")),p.animate=isZero(n.indexOf("-animate:")),p.colorprofile=isZero(n.indexOf("-colorprofile:"))},setSelectEvent=function(e){var t,n="*linecust "+c+",KC_main:SELECTEVENT";p.dodge?(PPx.Execute(n+",%(*execute V,*if %(0%*stayinfo(%sp'"+r+"')%:*js \":"+i+',ppx_Dodge"%)%)'),t="dodge"):(PPx.Execute(n+","),t="no dodge"),e&&PPx.linemessage(t)},horPos=function(){var e=Number(PPx.Extract("%*windowrect(,w)"));return Number(PPx.Extract('%*extract(C,"%%*cursorpos(x)")'))<=s-u?e<s?s:x-e:e<s?s-e:0},vertPos=function(){return Number(PPx.Extract("%*windowrect(,t)"))};main();
